-------------------------
-- 1. CREATE statements
-------------------------
-- Bestellpolitik soll ebenfalss als enumeration abgebildet werden, da diese
-- fix vorgegeben sind
CREATE TABLE BESTELLPOLITIK (
  BESTELL_ART VARCHAR(20),
  CONSTRAINT BESTELLPOLITIK_PK PRIMARY KEY(BESTELL_ART)
);

CREATE TABLE TEIL (
  TNR INTEGER not null,
  BEZEICHNUNG VARCHAR(255) not null,
  TEIL_ART VARCHAR(10),
  LAGERBESTAND INTEGER not null,
  MENGENEINHEIT VARCHAR(10) not null,
  CONSTRAINT TEIL_PK PRIMARY KEY(TNR)
);

CREATE TABLE ARTIKEL (
  TNR_ID INTEGER not null,
  VERKAUFSPREIS NUMBER(9, 2) not null,
  CONSTRAINT ARTIKEL_PK PRIMARY KEY(TNR_ID),
  CONSTRAINT ARTIKEL_TNR_ID_FK FOREIGN KEY(TNR_ID) REFERENCES TEIL(TNR)
);

CREATE TABLE FREMDTEIL (
  TNR_ID INTEGER not null,
  BESTELL_ART_ID VARCHAR(20) not null,
  CONSTRAINT FREMDTEIL_PK PRIMARY KEY(TNR_ID),
  CONSTRAINT FREMDTEIL_BESTELL_ART_ID_FK FOREIGN KEY(BESTELL_ART_ID) REFERENCES BESTELLPOLITIK(BESTELL_ART)
);

CREATE TABLE EIGENTEIL (
  TNR_ID INTEGER not null,
  LOSGROESSE INTEGER not null,
  CONSTRAINT EIGENTEIL_PK PRIMARY KEY(TNR_ID),
  CONSTRAINT EIGENTEIL_TNR_ID_FK FOREIGN KEY(TNR_ID) REFERENCES TEIL(TNR)
);

CREATE TABLE STRUKTUR (
  OBER_TNR_ID INTEGER not null,
  UNTER_TNR_ID INTEGER not null,
  MENGE INTEGER not null,
  CONSTRAINT STRUKTUR_ID PRIMARY KEY(OBER_TNR_ID, UNTER_TNR_ID),
  CONSTRAINT STRUKTUR_OBER_TNR_ID FOREIGN KEY(OBER_TNR_ID) REFERENCES TEIL(TNR),
  CONSTRAINT STRUKTUR_UNTER_TNR_ID FOREIGN KEY(UNTER_TNR_ID) REFERENCES TEIL(TNR)
);

CREATE TABLE ARBEITSPLAN (
  APNR INTEGER not null,
  ERSTELLER VARCHAR(100) not null,
  ERSTELLUNGS_DATUM TIMESTAMP not null,
  TNR_ID INTEGER not null,
  CONSTRAINT ARBEITSPLAN_PK PRIMARY KEY(APNR),
  CONSTRAINT ARBEITSPLAN_TNR_ID_FK FOREIGN KEY(TNR_ID) REFERENCES TEIL(TNR)
);

CREATE TABLE TECHNISCHES_VERFAHREN (
  VNR INTEGER not null,
  BEZEICHNUNG VARCHAR(255),
  CONSTRAINT TECH_VERF_VNR_ID_PK PRIMARY KEY(VNR)
);

CREATE TABLE ARBEITSGANG (
  APNR_ID INTEGER not null,
  AGNR INTEGER not null,
  VNR_ID INTEGER not null,
  CONSTRAINT ARBEITSGANG_PK PRIMARY KEY(APNR_ID, AGNR),
  CONSTRAINT ARBEITSPLAN_APNR_ID_FK FOREIGN KEY(APNR_ID) REFERENCES ARBEITSPLAN(APNR),
  CONSTRAINT TECHN_VERF_VNR_ID_FK FOREIGN KEY(VNR_ID) REFERENCES TECHNISCHES_VERFAHREN(VNR)
);

CREATE TABLE BETRIEBSMITTEL (
  BMNR INTEGER not null,
  BEZEICHNUNG VARCHAR(255),
  WARTUNG TIMESTAMP not null,
  CONSTRAINT BETRIEBSMITTEL_FK PRIMARY KEY(BMNR)
);

-- Da es keinen reinen TIME Datentyp gibt, also der nur Zeit im Format Bsp.: hh:mm:ss
-- speichert wird die Zeit mittels INTEGER (Sekunden) gespeichert und muss daher
-- auch applikatorisch in ein Datumsformat umgewandelt werden.
CREATE TABLE AG_BM_ZUORDNUNG (
  APNR_ID INTEGER not null,
  AGNR_ID INTEGER not null,
  BMNR_ID INTEGER not null,
  RUESTZEIT INTEGER not null,
  ARBEITSZEIT INTEGER not null,
  CONSTRAINT AG_BM_ZUORDNUNG_PK PRIMARY KEY(APNR_ID, AGNR_ID, BMNR_ID),
  CONSTRAINT AG_BM_ZUOR_ARB_FK FOREIGN KEY(APNR_ID, AGNR_ID) REFERENCES ARBEITSGANG(APNR_ID, AGNR)
);

CREATE TABLE AG_KOMP_ZUORDNUNG (
  APNR_ID INTEGER not null,
  AGNR_ID INTEGER not null,
  TNR_ID INTEGER not null,
  MENGE INTEGER not null,
  CONSTRAINT AG_KOMP_ZUORDNUNG_PK PRIMARY KEY(APNR_ID, AGNR_ID, TNR_ID),
  CONSTRAINT AG_KOMP_ZUOR_APNR_ID_FK FOREIGN KEY(APNR_ID, AGNR_ID) REFERENCES ARBEITSGANG (APNR_ID, AGNR),
  CONSTRAINT AG_KOMP_ZUOR_TNR_ID_FK FOREIGN KEY(TNR_ID) REFERENCES TEIL(TNR)
);

commit;

--------------------------
-- 2. ALTER statements
--------------------------
ALTER TABLE EIGENTEIL ADD (
  KONSTRUKTEUR VARCHAR(100),
  KONSTRUKTIONSDATUM TIMESTAMP
);
ALTER TABLE TEIL MODIFY TEIL_ART CHAR(1) not null;
ALTER TABLE TEIL ADD CONSTRAINT BEZEICHNUNG_UNIQUE UNIQUE(BEZEICHNUNG);
ALTER TABLE TEIL ADD CONSTRAINT TEIL_ART_ENUM CHECK(TEIL_ART IN ('A', 'E', 'F'));
ALTER TABLE TEIL MODIFY LAGERBESTAND default 0;

commit;

---------------------------
-- 3. INSERT statements
---------------------------
INSERT INTO BESTELLPOLITIK (BESTELL_ART) VALUES ('online');
INSERT INTO BESTELLPOLITIK (BESTELL_ART) VALUES ('EU-only');
INSERT INTO BESTELLPOLITIK (BESTELL_ART) VALUES ('Skonto-only');

-- dependencies for eigenteil 
INSERT INTO TEIL (TNR, BEZEICHNUNG, TEIL_ART, LAGERBESTAND, MENGENEINHEIT)
VALUES (1, 'Dichtung für Zulauf/Rücklauf', 'F', 100, 'Stk');

INSERT INTO TEIL (TNR, BEZEICHNUNG, TEIL_ART, LAGERBESTAND, MENGENEINHEIT)
VALUES (2, 'Schraube für Assembly', 'F', 100, 'Stk');

INSERT INTO TEIL (TNR, BEZEICHNUNG, TEIL_ART, LAGERBESTAND, MENGENEINHEIT)
VALUES (3, 'Gehäuse', 'E', 1000, 'Stk');

INSERT INTO TEIL (TNR, BEZEICHNUNG, TEIL_ART, LAGERBESTAND, MENGENEINHEIT)
VALUES (4, 'Pumpe', 'E', 96, 'Stk');

-- article to sell
INSERT INTO TEIL (TNR, BEZEICHNUNG, TEIL_ART, LAGERBESTAND, MENGENEINHEIT)
VALUES (5, 'Brunnenpumpe', 'A', 120, 'Stk');

-- assemble dependecies
INSERT INTO STRUKTUR (OBER_TNR_ID, UNTER_TNR_ID, MENGE) VALUES (5, 1, 10);
INSERT INTO STRUKTUR (OBER_TNR_ID, UNTER_TNR_ID, MENGE) VALUES (5, 2, 50);
INSERT INTO STRUKTUR (OBER_TNR_ID, UNTER_TNR_ID, MENGE) VALUES (5, 3, 1);
INSERT INTO STRUKTUR (OBER_TNR_ID, UNTER_TNR_ID, MENGE) VALUES (5, 4, 1);

-- work plan
INSERT INTO ARBEITSPLAN (APNR, ERSTELLER, ERSTELLUNGS_DATUM, TNR_ID)
VALUES (1, 'Ing. Thomas Herzog', CURRENT_TIMESTAMP, 5);

-- technices
INSERT INTO TECHNISCHES_VERFAHREN (VNR, BEZEICHNUNG)
VALUES (1, 'Leitung mit Dichtung verbinden');

INSERT INTO TECHNISCHES_VERFAHREN (VNR, BEZEICHNUNG)
VALUES (2, 'Gehäuse schweisen');

INSERT INTO TECHNISCHES_VERFAHREN (VNR, BEZEICHNUNG)
VALUES (3, 'Dichtschrauben');

-- work steps
INSERT INTO ARBEITSGANG (APNR_ID, AGNR, VNR_ID)
VALUES(1, 1, 1);

INSERT INTO ARBEITSGANG (APNR_ID, AGNR, VNR_ID)
VALUES(1, 2, 2);

INSERT INTO ARBEITSGANG (APNR_ID, AGNR, VNR_ID)
VALUES(1, 3, 3);

-- used tools
INSERT INTO BETRIEBSMITTEL (BMNR, BEZEICHNUNG, WARTUNG)
VALUES (1, 'Schraubenzieher', CURRENT_TIMESTAMP);

INSERT INTO BETRIEBSMITTEL (BMNR, BEZEICHNUNG, WARTUNG)
VALUES (2, 'Schweisgerät', CURRENT_TIMESTAMP);

INSERT INTO BETRIEBSMITTEL (BMNR, BEZEICHNUNG, WARTUNG)
VALUES (3, 'Dichtungsmittelspritze', CURRENT_TIMESTAMP);

-- tools work step assignment
INSERT INTO AG_BM_ZUORDNUNG (APNR_ID, AGNR_ID, BMNR_ID, RUESTZEIT, ARBEITSZEIT)
VALUES (1, 1, 3, 60, 200);

INSERT INTO AG_BM_ZUORDNUNG (APNR_ID, AGNR_ID, BMNR_ID, RUESTZEIT, ARBEITSZEIT)
VALUES (1, 1, 2, 500, 2000);

INSERT INTO AG_BM_ZUORDNUNG (APNR_ID, AGNR_ID, BMNR_ID, RUESTZEIT, ARBEITSZEIT)
VALUES (1, 1, 1, 10, 1560);

-- compononent assignment
INSERT INTO AG_KOMP_ZUORDNUNG (APNR_ID, AGNR_ID, TNR_ID, MENGE)
VALUES (1, 1, 1, 20);

INSERT INTO AG_KOMP_ZUORDNUNG (APNR_ID, AGNR_ID, TNR_ID, MENGE)
VALUES (1, 1, 4, 1);

INSERT INTO AG_KOMP_ZUORDNUNG (APNR_ID, AGNR_ID, TNR_ID, MENGE)
VALUES (1, 2, 3, 1);

INSERT INTO AG_KOMP_ZUORDNUNG (APNR_ID, AGNR_ID, TNR_ID, MENGE)
VALUES (1, 2, 4, 1);

INSERT INTO AG_KOMP_ZUORDNUNG (APNR_ID, AGNR_ID, TNR_ID, MENGE)
VALUES (1, 3, 3, 1);

INSERT INTO AG_KOMP_ZUORDNUNG (APNR_ID, AGNR_ID, TNR_ID, MENGE)
VALUES (1, 3, 2, 50);

commit;

---------------------------
-- 4. DROP statements
---------------------------
DROP TABLE AG_KOMP_ZUORDNUNG;
DROP TABLE AG_BM_ZUORDNUNG;
DROP TABLE BETRIEBSMITTEL;
DROP TABLE ARBEITSGANG;
DROP TABLE TECHNISCHES_VERFAHREN;
DROP TABLE ARBEITSPLAN;
DROP TABLE STRUKTUR;
DROP TABLE EIGENTEIL;
DROP TABLE FREMDTEIL;
DROP TABLE ARTIKEL;
DROP TABLE TEIL;
DROP TABLE BESTELLPOLITIK;

commit;

